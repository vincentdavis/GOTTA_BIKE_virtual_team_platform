{% extends "base.html" %}
{% load team_tags %}

{% block title %}Team Links - The Coalition{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
  <div class="card bg-base-200 shadow-xl">
    <div class="card-body">
      <div class="flex justify-between items-center mb-6">
        <h2 class="card-title text-2xl">Team Links</h2>
      </div>

      <!-- Filters -->
      <form method="get" class="mb-6">
        <div class="flex flex-wrap gap-4 items-end">
          <div class="form-control">
            <label class="label">
              <span class="label-text">Search</span>
            </label>
            <input type="text"
                   name="q"
                   placeholder="Search links..."
                   class="input input-bordered input-sm w-48"
                   value="{{ search_query }}"
            />
          </div>

          <div class="form-control">
            <label class="label">
              <span class="label-text">Type</span>
            </label>
            <select name="type" class="select select-bordered select-sm">
              <option value="">All Types</option>
              {% for value, label in available_types %}
                <option value="{{ value }}" {% if type_filter == value %}selected{% endif %}>
                  {{ label }}
                </option>
              {% endfor %}
            </select>
          </div>

          {% if available_permissions %}
          <div class="form-control">
            <label class="label">
              <span class="label-text">Permission</span>
            </label>
            <select name="permission" class="select select-bordered select-sm">
              <option value="">All Permissions</option>
              {% for value, label in available_permissions %}
                <option value="{{ value }}" {% if permission_filter == value %}selected{% endif %}>
                  {{ label }}
                </option>
              {% endfor %}
            </select>
          </div>
          {% endif %}

          <button type="submit" class="btn btn-primary btn-sm">Filter</button>
          <a href="{% url 'team:links' %}" class="btn btn-ghost btn-sm">Reset</a>
        </div>
      </form>

      <!-- Links List -->
      <div class="space-y-4">
        {% for link in links %}
        <div class="card bg-base-300">
          <div class="card-body p-4">
            <div class="flex justify-between items-start">
              <div class="flex-1">
                <h3 class="font-semibold text-lg flex items-center gap-2">
                  <a href="{{ link.url }}" target="_blank" rel="noopener" class="link link-primary hover:link-hover">
                    {{ link.title }}
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                    </svg>
                  </a>
                  {% if can_edit_links %}
                  <a href="{% url 'team:edit_link' link.pk %}" class="btn btn-ghost btn-xs" title="Edit link">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                  </a>
                  {% else %}
                  <span class="btn btn-ghost btn-xs btn-disabled opacity-30" title="You don't have permission to edit">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                  </span>
                  {% endif %}
                </h3>
                {% if link.description %}
                <p class="text-sm text-base-content/70 mt-1">{{ link.description }}</p>
                {% endif %}
              </div>
              <div class="flex flex-wrap gap-1 ml-4">
                {% for type_value in link.link_types %}
                <span class="badge badge-sm {{ type_value|link_type_badge_class }}">{{ type_value }}</span>
                {% empty %}
                <span class="badge badge-sm badge-ghost">Uncategorized</span>
                {% endfor %}
                {% for perm_key in link.permissions %}
                <span class="badge badge-sm badge-outline {{ perm_key|permission_badge_class }}">{{ perm_key|permission_display_name }}</span>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="text-center py-8 text-base-content/50">
          No links found.
        </div>
        {% endfor %}
      </div>

      <!-- Stats -->
      <div class="mt-6 text-sm text-base-content/50">
        Showing {{ links|length }} link{{ links|length|pluralize }}
      </div>
    </div>
  </div>
</div>
{% endblock %}
